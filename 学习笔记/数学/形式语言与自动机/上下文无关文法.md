# 下推自动机和上下文无关文法

“无限状态自动机”：由无穷多个有限状态自动机组成的自动机$L=\sum_{n=0}^\infty\bm 0^n\bm 1^n=\{0^n1^n|n\geq 0\}$

## 上下文无关文法(CFG, Context-Free Grammar)

CFG为一个四元组：

$$G=(V,T,P,S)$$

* $V$：非终结符（变量、语法范畴）的有穷集
* $T$：终结符的有穷集
  * 终结符和非终结符不能有重复$V\cap T=\emptyset$
* $P$：产生式的有穷集，产生式可以表示为$A\rightarrow\alpha$，读作“$A$定义为$\alpha$”，其中
  * $A$：产生式的头/左部，$A\in V$
  * $\rightarrow$：产生式符号，表示“定义为”
  * $\alpha$：产生式的体/右部，$\alpha\in (V\cup T)^*$是一个字符串
* $S$：初始符号，$S\in V$

注：
* 多条产生式$A\rightarrow\alpha_1,A\rightarrow\alpha_2,A\rightarrow\alpha_3,\dots$合写为$A\rightarrow\alpha_1|\alpha_2|\alpha_3|\dots$
* 变元$A$的全体产生式称为$A$产生式

## 规约（由字符串到CFG）和派生（由CFG到字符串）

对于一个CFG$G=(V,T,P,S)$，字符串$\alpha,\beta,\gamma\in(V\cup T)^*$

### “可派生”和“可规约”符号$\mathop{\Rightarrow}\limits_{G}$定义

用$A\rightarrow\gamma$的右部替换$\alpha A\beta$中的变元$A$得到$\alpha\gamma\beta$

$$\alpha A\beta\mathop{\Rightarrow}\limits_{G}\alpha\gamma\beta\quad:=\quad
\begin{aligned}
\alpha A\beta\text{可派生出}\alpha\gamma\beta\\
\alpha\gamma\beta\text{可规约为}\alpha A\beta\\
\end{aligned}
\quad:=\quad
(\exist A\in V)A\rightarrow\gamma\in P
$$

### “$m$步派生”符号$\mathop{\Rightarrow}\limits_{G}^m$定义

$\alpha$经过$m$次派生过程可以得到$\beta$

$$
\alpha\mathop{\Rightarrow}\limits_{G}^m\beta\quad:=\quad(\exist\alpha_1,\dots\alpha_m\in(V\cup T)^*,\alpha_i\mathop{\Rightarrow}\limits_{G}\alpha_{i+1})\alpha=\alpha_1,\beta=\alpha_m
$$

### “多步派生”符号$\mathop{\Rightarrow}\limits_{G}^*$定义

$\alpha$经过多次派生过程可以得到$\beta$

$$
\alpha\mathop{\Rightarrow}\limits_{G}^*\beta\quad:=\quad(\exist m\in\mathbb N_+)\alpha\mathop{\Rightarrow}\limits_{G}^m\beta
$$

若语境中$G$已知，则$G$可省略。$\mathop{\Rightarrow}\limits_{G}$、$\mathop{\Rightarrow}\limits_{G}^m$、$\mathop{\Rightarrow}\limits_{G}^*$可分别省略为$\mathop{\Rightarrow}\limits$、$\mathop{\Rightarrow}\limits^m$、$\mathop{\Rightarrow}\limits^*$。

### “最左派生”符号$\mathop{\Rightarrow}\limits_{lm}$定义

只替换字符串最左边的变元

$$\alpha A\beta\mathop{\Rightarrow}\limits_{lm}\limits\alpha\gamma\beta\quad:=\quad\alpha A\beta\mathop{\Rightarrow}\limits\alpha\gamma\beta\wedge\alpha\text{中没有变元}$$

同理可定义“$m$步最左派生”$\mathop{\Rightarrow}\limits_{lm}^m$和“多步最左派生”$\mathop{\Rightarrow}\limits_{lm}^*$。

### “最右派生”符号$\mathop{\Rightarrow}\limits_{rm}$定义

只替换字符串最右边的变元

$$\alpha A\beta\mathop{\Rightarrow}\limits_{lm}\limits\alpha\gamma\beta\quad:=\quad\alpha A\beta\mathop{\Rightarrow}\limits\alpha\gamma\beta\wedge\beta\text{中没有变元}$$

同理可定义“$m$步最右派生”$\mathop{\Rightarrow}\limits_{rm}^m$和“多步最右派生”$\mathop{\Rightarrow}\limits_{rm}^*$。

任何派生都有等价的最左和最右派生过程

$$A\mathop{\Rightarrow}\limits^*w\Leftrightarrow A\mathop{\Rightarrow}\limits_{lm}^*w\Leftrightarrow A\mathop{\Rightarrow}\limits_{rm}^*w$$

## 上下文无关语言(CFL, Context-Free Language)：上下文无关文法的语言

CFG$G=(V,T,P,S)$的语言定义为：由初始符号派生的所有仅由终结符构成字符串的集合

$$\bm L(G)=\{w|w\in T^*,S\mathop{\Rightarrow}\limits_{G}^*w\}$$

在上下文无关文法派生的每一步$\alpha A\beta\mathop{\Rightarrow}\limits_{G}\alpha\gamma\beta$，$\gamma$都只与$A$有关而与$\alpha$和$\beta$无关，因此称为“上下文无关”语言。

$$
\begin{aligned}
\alpha\text{是}G\text{的句型}&:=&\alpha\in(V\cup T)^*\wedge S\mathop{\Rightarrow}\limits^*\alpha&\\
\alpha\text{是}G\text{的左句型}&:=&\alpha\in(V\cup T)^*\wedge S\mathop{\Rightarrow}\limits_{lm}^*\alpha&\\
\alpha\text{是}G\text{的右句型}&:=&\alpha\in(V\cup T)^*\wedge S\mathop{\Rightarrow}\limits_{rm}^*\alpha&\\
\alpha\text{是}G\text{的句子}&:=&\alpha\in T^*\wedge S\mathop{\Rightarrow}\limits^*\alpha&\\
\end{aligned}
$$

## 案例

前3个案例来自于[《正则语言》](./正则语言.md)一节，它们都不是正则语言，但是是上下文无关语言。

### 语言$L=\sum_{n=0}^\infty\bm 0^n\bm 1^n=\{0^n1^n|n\geq 0\}$的CFG

$$G=(\{S\},\{0,1\},\{S\rightarrow\varepsilon|0S1\},S)$$

### 语言$L=\{w|w\text{由数量相等的01构成}\}$的CFG

$$G=(\{S\},\{0,1\},\{S\rightarrow\varepsilon|S0S1S|S1S0S\},S)$$

### 语言$L=\{0^i1^j|i>j\}$的CFG

$$G=(\{S,A,B\},\{0,1\},\{S\rightarrow AB,A\rightarrow A0|0,B\rightarrow\varepsilon|0B1\},S)$$

### 回文语言$L=\{w\in\{0,1\}^*|w=w^R\}$的CFG

$$G=(\{A\},\{0,1\},\{A\rightarrow\varepsilon|0|1|0A0|1A1\},A)$$
例如，回文串$0101001001010$的派生过程：
$$
\begin{aligned}
    &A\\
    &\Downarrow\text{使用产生式}A\rightarrow 0A0\\
    0&A0\\
    &\Downarrow\text{使用产生式}A\rightarrow 1A1\\
    01&A10\\
    &\Downarrow\text{使用产生式}A\rightarrow 0A0\\
    010&A010\\
    &\Downarrow\text{使用产生式}A\rightarrow 1A1\\
    0101&A1010\\
    &\Downarrow\text{使用产生式}A\rightarrow 0A0\\
    01010&A01010\\
    &\Downarrow\text{使用产生式}A\rightarrow 0A0\\
    010100&A001010\\
    &\Downarrow\text{使用产生式}A\rightarrow 1\\
    010100&1001010\\
\end{aligned}
$$

### 四则运算表达式的CFG

表示一个由加减乘除和括号以及二进制数表示的四则运算CFG
$$G=\{\{E,I\},\{0,1,+,-,\times,\div,(,)\},P,E\}$$
其中，产生式的有穷集$P$为：
$$
P=\left\{
\begin{aligned}
E&\rightarrow E+E\\
E&\rightarrow E-E\\
E&\rightarrow E\times E\\
E&\rightarrow E\div E\\
E&\rightarrow (E)\\
E&\rightarrow I\\
I&\rightarrow I0\\
I&\rightarrow I1\\
I&\rightarrow 0\\
I&\rightarrow 1\\
\end{aligned}
\right\}
$$